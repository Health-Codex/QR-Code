<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POCUS Resources and Case Studies for Clinicians</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Visually Hidden Utility: Hides content accessibly */
        .visually-hidden { position: absolute; width: 1px; height: 1px; margin: -1px; padding: 0; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }
        /* Enhanced Focus Visible styles for better accessibility */
        *:focus-visible { outline: 3px solid #2563eb; /* Blue-600 */ outline-offset: 2px; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.4); }
        /* Modal Transitions */
        #modal { transition: opacity 0.3s ease-in-out; }
        #modal-content-box { transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out; }
        #modal.opacity-0 { pointer-events: none; }
        #modal.opacity-0 #modal-content-box { transform: scale(0.95); opacity: 0; }
        /* Hide diagnosis section initially */
        .diagnosis-section.hidden { display: none; }
        /* Style for modal images */
        #modal-image-container img {
            border: 1px solid #e5e7eb; /* Gray-200 */
            object-fit: contain; /* Ensure entire image is visible */
            max-height: 300px; /* Constrain image height */
            width: auto; /* Allow width to adjust */
            max-width: 100%; /* Prevent exceeding container width */
            margin-left: auto;
            margin-right: auto;
            background-color: #f9fafb; /* Light gray background for images */
            border-radius: 0.375rem; /* Rounded corners */
        }

        /* --- Enhanced Styles for interactive anatomy overlays --- */
        .anatomy-overlay {
            position: absolute;
            border: 2px solid rgba(59, 130, 246, 0.7); /* Semi-transparent blue border */
            border-radius: 12px; /* Rounded rectangle */
            cursor: pointer;
            transition: all 0.3s ease;
            /* Simple, clean visual style */
            background-color: rgba(59, 130, 246, 0.2); /* Light blue background */
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.3); /* Subtle glow */
            z-index: 5; /* Ensure overlays are above the image */
        }

        .anatomy-overlay:hover,
        .anatomy-overlay:focus-visible {
            background-color: rgba(59, 130, 246, 0.3);
            border-color: rgba(37, 99, 235, 0.9); /* Darker blue border on hover/focus */
            box-shadow: 0 0 12px rgba(37, 99, 235, 0.5); /* Enhanced glow */
            transform: scale(1.03); /* Slight zoom effect on hover */
        }

        /* Pulse animation for active overlay */
        .anatomy-overlay.active {
            animation: pulse 2s infinite;
            background-color: rgba(59, 130, 246, 0.4);
            border-color: rgba(37, 99, 235, 1);
            box-shadow: 0 0 15px rgba(37, 99, 235, 0.6);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 10px rgba(37, 99, 235, 0.5); }
            50% { box-shadow: 0 0 20px rgba(37, 99, 235, 0.7); }
            100% { box-shadow: 0 0 10px rgba(37, 99, 235, 0.5); }
        }

        /* 3D effect for the anatomy figure */
        #anatomy-figure {
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        #anatomy-diagram-img {
            transition: all 0.5s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border-radius: 12px;
        }

        /* --- UPDATED Overlay Positions for enhanced anatomical SVG model --- */
        /* Neck (IJV area) */
        #anatomy-region-vascular-neck {
            top: 15%;
            left: 40%;
            width: 20%;
            height: 8%;
        }

        /* Lungs */
        #anatomy-region-lungs {
            top: 30%;
            left: 25%;
            width: 50%;
            height: 25%;
        }

        /* Cardiac (Heart) */
        #anatomy-region-cardiac {
            top: 30%;
            left: 38%;
            width: 24%;
            height: 12%;
            border-radius: 50%; /* Keep circular for heart */
        }

        /* RUQ (Liver, Gallbladder area) */
        #anatomy-region-ruq {
            top: 40%;
            left: 52%;
            width: 22%;
            height: 15%;
        }

        /* LUQ (Spleen, Stomach area) */
        #anatomy-region-luq {
            top: 40%;
            left: 26%;
            width: 22%;
            height: 15%;
        }

        /* Pelvis (Suprapubic/Bladder area) */
        #anatomy-region-pelvis {
            top: 60%;
            left: 38%;
            width: 24%;
            height: 12%;
        }

        /* Leg Vascular (Femoral Triangle area) */
        #anatomy-region-vascular-leg {
            top: 75%;
            left: 40%;
            width: 20%;
            height: 12%;
        }

    </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">

    <header class="bg-gradient-to-br from-blue-600 to-blue-800 text-white text-center py-12 md:py-16 px-4 shadow-lg">
        <h1 class="text-4xl md:text-5xl font-bold uppercase tracking-wide mb-3">POCUS Resources for Clinicians</h1>
        <p class="text-xl md:text-2xl font-light mb-4">Empowering PAs and Physicians with Point-of-Care Ultrasound knowledge.</p>
        <p class="text-lg md:text-xl font-normal text-blue-100">"Enhance diagnostic accuracy and improve patient care at the bedside."</p>
    </header>

    <div class="max-w-6xl mx-auto p-4 md:p-8 mt-[-2.5rem] mb-10 relative z-10">
        <main class="bg-white rounded-xl shadow-xl p-6 sm:p-8 md:p-10">

            <section aria-labelledby="resources-heading" class="mb-16">
                <h2 id="resources-heading" class="text-3xl md:text-4xl font-semibold text-blue-700 text-center mb-10">Core Learning Resources</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8">
                    <div class="resource-card bg-gray-50 rounded-lg border border-gray-200 hover:shadow-lg transition-shadow duration-300 p-6 text-center flex flex-col items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-500 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>
                        <h3 class="text-xl font-semibold text-blue-600 mb-2">Comprehensive Guide</h3>
                        <p class="text-gray-600 mb-5 text-sm leading-relaxed flex-grow">Detailed best practices and techniques for various POCUS applications.</p>
                        <a href="https://raw.githubusercontent.com/Health-Codex/QR-Code/main/POCUS_Guide.pdf"
                           target="_blank"
                           rel="noopener noreferrer"
                           class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-full shadow hover:shadow-md transition duration-300 ease-in-out text-base mt-auto focus-visible:outline-white">
                            Download PDF
                        </a>
                    </div>
                    <div class="resource-card bg-gray-50 rounded-lg border border-gray-200 hover:shadow-lg transition-shadow duration-300 p-6 text-center flex flex-col items-center">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-500 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m9.75 0h-3.375c-.621 0-1.125.504-1.125 1.125v6.625c0 .621.504 1.125 1.125 1.125h3.375c.621 0 1.125-.504 1.125-1.125V11.25a1.125 1.125 0 00-1.125-1.125z" /></svg>
                        <h3 class="text-xl font-semibold text-blue-600 mb-2">Quick Reference Cards</h3>
                        <p class="text-gray-600 mb-5 text-sm leading-relaxed flex-grow">Pocket-sized cards for rapid review during clinical practice.</p>
                         <a href="https://www.pocus101.com/pocket-cards/" target="_blank" rel="noopener noreferrer" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-full shadow hover:shadow-md transition duration-300 ease-in-out text-base mt-auto focus-visible:outline-white">
                             View Cards
                         </a>
                    </div>
                    <div class="resource-card bg-gray-50 rounded-lg border border-gray-200 hover:shadow-lg transition-shadow duration-300 p-6 text-center flex flex-col items-center">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-500 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>
                        <h3 class="text-xl font-semibold text-blue-600 mb-2">Image & Case Atlas</h3>
                        <p class="text-gray-600 mb-5 text-sm leading-relaxed flex-grow">Enhance diagnostic skills with a diverse collection of ultrasound images and cases.</p>
                         <a href="https://www.thepocusatlas.com/home" target="_blank" rel="noopener noreferrer" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-full shadow hover:shadow-md transition duration-300 ease-in-out text-base mt-auto focus-visible:outline-white">
                             Explore Atlas
                         </a>
                    </div>
                </div>
            </section>

            <section class="case-studies mb-16" aria-labelledby="casestudies-heading">
                <h2 id="casestudies-heading" class="text-3xl md:text-4xl font-semibold text-blue-700 text-center mb-10">Interactive Clinical Case Studies</h2>
                <div class="space-y-8">
                    <article class="case bg-white rounded-xl border border-gray-200 shadow-sm hover:shadow-lg transition-shadow duration-300 p-6 md:p-8 overflow-hidden">
                        <h3 class="text-xl font-semibold text-blue-800 mb-4">Case Study: Acute Shortness of Breath Post-Trauma</h3>
                        <p class="text-gray-700 mb-4">A 45-year-old male presented with acute shortness of breath after a fall from height.</p>
                        <dl class="text-sm space-y-2 mb-5">
                            <div>
                                <dt class="font-semibold text-gray-800 inline">Clinical Presentation:</dt>
                                <dd class="inline text-gray-600 ml-1">Sudden onset dyspnea, sharp right-sided pleuritic chest pain, tachypnea (RR 28), hypoxia (SpO2 90% RA), decreased breath sounds on the right hemithorax.</dd>
                            </div>
                            <div>
                                <dt class="font-semibold text-gray-800 inline">POCUS Application:</dt>
                                <dd class="inline text-gray-600 ml-1">Lung Ultrasound (evaluation for traumatic lung injury).</dd>
                            </div>
                             <div>
                                <dt class="font-semibold text-gray-800 inline">Key Question:</dt>
                                <dd class="inline text-gray-600 ml-1">How can POCUS rapidly assess for life-threatening causes of acute dyspnea in this trauma patient?</dd>
                            </div>
                        </dl>
                        <button class="read-more-btn bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-full shadow hover:shadow-md transition duration-300 ease-in-out focus-visible:outline-white"
                                data-title="Case Study: Acute Shortness of Breath Post-Trauma"
                                data-vignette="A 45-year-old male presents to the ED with sudden onset shortness of breath and sharp right-sided chest pain after falling approximately 10 feet off a ladder. Vitals: RR 28, HR 115, BP 130/80, SpO2 90% on room air. Exam reveals decreased breath sounds and hyperresonance to percussion on the right hemithorax."
                                data-imaging="Bedside lung POCUS is performed using a linear probe in the anterior chest zones. On the right side, pleural sliding ('ants marching') is absent. Multiple horizontal reverberation artifacts (A-lines) are seen, indicating air below the probe. M-mode interrogation across the pleural line demonstrates the 'stratosphere' or 'barcode' sign, confirming lack of lung sliding. The 'lung point' sign (junction between sliding and non-sliding lung) is identified laterally. The left lung shows normal lung sliding ('seashore' sign on M-mode)."
                                data-image-placeholder-1="https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExdjhpbzdjcTVkNjhkZTJsdXp1ZGtwajF0N3dtdDhpYWMzbXU1azRmaCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/Iu1x4Ocxa9TMW4pfwa/giphy.gif"
                                data-image-alt-1="POCUS B-mode showing absent lung sliding in pneumothorax"
                                data-image-placeholder-2="https://raw.githubusercontent.com/Health-Codex/QR-Code/main/M-Line.jpg"
                                data-image-alt-2="POCUS M-mode showing the 'barcode' or 'stratosphere' sign in pneumothorax"
                                data-diagnosis-title="Diagnosis: Pneumothorax"
                                data-diagnosis-explanation="Interpretation & Outcome: The POCUS findings (absent lung sliding, A-lines, barcode sign, lung point) are highly specific for pneumothorax. This allows for rapid bedside diagnosis, bypassing the need for potentially delaying chest X-ray in an unstable patient. Urgent needle decompression followed by chest tube placement was performed, leading to improvement in oxygenation and respiratory status.">
                            See Details & Findings
                        </button>
                    </article>

                     <article class="case bg-white rounded-xl border border-gray-200 shadow-sm hover:shadow-lg transition-shadow duration-300 p-6 md:p-8 overflow-hidden">
                        <h3 class="text-xl font-semibold text-blue-800 mb-4">Case Study: Hypotension & Distended Neck Veins</h3>
                        <p class="text-gray-700 mb-4">A 60-year-old female with a history of malignancy presented with progressive weakness and shock.</p>
                        <dl class="text-sm space-y-2 mb-5">
                             <div>
                                <dt class="font-semibold text-gray-800 inline">Clinical Presentation:</dt>
                                <dd class="inline text-gray-600 ml-1">Hypotension (BP 85/50), tachycardia (HR 120), marked jugular venous distension (JVD), muffled heart sounds, pulsus paradoxus noted.</dd>
                            </div>
                            <div>
                                <dt class="font-semibold text-gray-800 inline">POCUS Application:</dt>
                                <dd class="inline text-gray-600 ml-1">Focused Cardiac Ultrasound (ECHO) and IVC assessment.</dd>
                            </div>
                             <div>
                                <dt class="font-semibold text-gray-800 inline">Key Question:</dt>
                                <dd class="inline text-gray-600 ml-1">What are the key POCUS findings to differentiate causes of obstructive shock in this patient?</dd>
                            </div>
                        </dl>
                        <button class="read-more-btn bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-full shadow hover:shadow-md transition duration-300 ease-in-out focus-visible:outline-white"
                                data-title="Case Study: Hypotension & Distended Neck Veins"
                                data-vignette="A 60-year-old female with metastatic breast cancer presents with several days of increasing weakness, dizziness, and dyspnea on exertion. Vitals: BP 85/50, HR 120, RR 22. Exam reveals JVD to the angle of the jaw, distant heart sounds, cool extremities, and a significant decrease in systolic blood pressure during inspiration (pulsus paradoxus)."
                                data-imaging="Focused cardiac POCUS (subxiphoid and apical 4-chamber views) reveals a large, circumferential anechoic (black) space surrounding the heart, consistent with a pericardial effusion (PE). Diastolic collapse of the right ventricle (RV) free wall is clearly visualized, indicating increased intrapericardial pressure exceeding RV diastolic pressure. The right atrium (RA) also shows systolic collapse. Assessment of the inferior vena cava (IVC) reveals a dilated diameter (>2.1 cm) with less than 50% collapse during inspiration (plethoric IVC)."
                                data-image-placeholder-1="https://placehold.co/400x300/e0f2fe/0c4a6e?text=Tamponade+Subcostal+(RV+Collapse)"
                                data-image-alt-1="POCUS Subcostal view: large pericardial effusion (PE) and RV diastolic collapse"
                                data-image-placeholder-2="https://placehold.co/400x300/e0f2fe/0c4a6e?text=Plethoric+IVC"
                                data-image-alt-2="POCUS showing a dilated (plethoric) IVC with minimal respiratory collapse"
                                data-diagnosis-title="Diagnosis: Obstructive Shock due to Cardiac Tamponade"
                                data-diagnosis-explanation="Interpretation & Outcome: The combination of a significant pericardial effusion with POCUS signs of right-sided chamber collapse (RV diastolic, RA systolic) and a plethoric, non-collapsing IVC confirms cardiac tamponade physiology as the cause of obstructive shock. This is a life-threatening emergency. An urgent pericardiocentesis was performed under ultrasound guidance, removing 500ml of serosanguinous fluid. The patient's hemodynamics improved immediately post-procedure.">
                            See Details & Findings
                        </button>
                    </article>

                    <article class="case bg-white rounded-xl border border-gray-200 shadow-sm hover:shadow-lg transition-shadow duration-300 p-6 md:p-8 overflow-hidden">
                        <h3 class="text-xl font-semibold text-blue-800 mb-4">Case Study: Blunt Abdominal Trauma & Instability</h3>
                         <p class="text-gray-700 mb-4">A 35-year-old unrestrained driver involved in a high-speed MVC presented with hypotension.</p>
                         <dl class="text-sm space-y-2 mb-5">
                             <div>
                                <dt class="font-semibold text-gray-800 inline">Clinical Presentation:</dt>
                                <dd class="inline text-gray-600 ml-1">Hypotension (BP 90/60), tachycardia (HR 130), abdominal tenderness (especially LUQ), mechanism concerning for intra-abdominal injury.</dd>
                            </div>
                            <div>
                                <dt class="font-semibold text-gray-800 inline">POCUS Application:</dt>
                                <dd class="inline text-gray-600 ml-1">FAST Exam (Focused Assessment with Sonography for Trauma).</dd>
                            </div>
                             <div>
                                <dt class="font-semibold text-gray-800 inline">Key Question:</dt>
                                <dd class="inline text-gray-600 ml-1">In this hemodynamically unstable trauma patient, what is the primary goal of the FAST exam?</dd>
                            </div>
                        </dl>
                         <button class="read-more-btn bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-full shadow hover:shadow-md transition duration-300 ease-in-out focus-visible:outline-white"
                                data-title="Case Study: Blunt Abdominal Trauma & Instability"
                                data-vignette="A 35-year-old male driver is brought in by EMS after a high-speed MVC where he was ejected from the vehicle. He complains of diffuse abdominal pain, worse in the LUQ. Vitals: BP 90/60, HR 130, RR 24. Received 1L crystalloid en route with minimal improvement in BP. Abdomen is tender to palpation diffusely, with guarding noted."
                                data-imaging="A FAST exam is rapidly performed. The right upper quadrant (RUQ) view (hepatorenal recess / Morison's pouch) shows a clear anechoic (black) stripe representing free fluid between the liver and kidney. The left upper quadrant (LUQ) view (splenorenal recess) reveals a larger collection of anechoic fluid surrounding the spleen. The suprapubic view also demonstrates free fluid posterior to the bladder. The pericardial view is negative for effusion."
                                data-image-placeholder-1="https://placehold.co/400x300/e0f2fe/0c4a6e?text=FAST+RUQ+(Morison's+Pouch+Fluid)"
                                data-image-alt-1="POCUS FAST RUQ view: free fluid (anechoic stripe) in Morison's pouch"
                                data-image-placeholder-2="https://placehold.co/400x300/e0f2fe/0c4a6e?text=FAST+LUQ+(Splenorenal+Fluid)"
                                data-image-alt-2="POCUS FAST LUQ view: free fluid (anechoic area) in the splenorenal recess"
                                data-diagnosis-title="Diagnosis: Hemoperitoneum (Positive FAST Exam)"
                                data-diagnosis-explanation="Interpretation & Outcome: The primary goal of the FAST exam in unstable trauma is to identify free intraperitoneal fluid, which in this context is presumed to be blood (hemoperitoneum). The presence of anechoic free fluid in multiple dependent areas (Morison's pouch, splenorenal recess, pelvis) constitutes a positive FAST exam. This strongly indicates significant intra-abdominal hemorrhage. Given the patient's hemodynamic instability and positive FAST, he was taken emergently to the operating room for exploratory laparotomy, where a splenic laceration and mesenteric injury were found and repaired.">
                            See Details & Findings
                        </button>
                    </article>

                    <article class="case bg-white rounded-xl border border-gray-200 shadow-sm hover:shadow-lg transition-shadow duration-300 p-6 md:p-8 overflow-hidden">
                        <h3 class="text-xl font-semibold text-blue-800 mb-4">Case Study: Progressive Dyspnea in Cancer Patient</h3>
                        <p class="text-gray-700 mb-4">A 55-year-old patient with known metastatic lung cancer presented with worsening shortness of breath over several days.</p>
                        <dl class="text-sm space-y-2 mb-5">
                            <div>
                                <dt class="font-semibold text-gray-800 inline">Clinical Presentation:</dt>
                                <dd class="inline text-gray-600 ml-1">Progressive dyspnea, orthopnea, non-productive cough. Exam shows dullness to percussion and decreased breath sounds over the left lower lung field.</dd>
                            </div>
                            <div>
                                <dt class="font-semibold text-gray-800 inline">POCUS Application:</dt>
                                <dd class="inline text-gray-600 ml-1">Lung and Pleural Ultrasound.</dd>
                            </div>
                             <div>
                                <dt class="font-semibold text-gray-800 inline">Key Question:</dt>
                                <dd class="inline text-gray-600 ml-1">How can POCUS characterize the cause of decreased breath sounds and guide potential intervention?</dd>
                            </div>
                        </dl>
                         <button class="read-more-btn bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-full shadow hover:shadow-md transition duration-300 ease-in-out focus-visible:outline-white"
                                data-title="Case Study: Progressive Dyspnea in Cancer Patient"
                                data-vignette="A 55-year-old patient with known stage IV NSCLC presents with several days of worsening dyspnea, now requiring 3 pillows to sleep (orthopnea). No fever or chills. Exam reveals dullness to percussion and markedly diminished breath sounds over the lower half of the left posterior and lateral chest."
                                data-imaging="Lung POCUS performed over the area of dullness using a curvilinear probe reveals a large anechoic (black) space superior to the diaphragm (D), consistent with a pleural effusion. The compressed (atelectatic) lower lobe of the lung (L) is seen 'flapping' within the fluid ('jellyfish sign'). Visualization of the thoracic vertebral bodies above the diaphragm (positive 'spine sign') further confirms the presence of fluid allowing sound transmission. Measurement estimates the effusion size as large."
                                data-image-placeholder-1="https://placehold.co/400x300/e0f2fe/0c4a6e?text=Pleural+Effusion+(Jellyfish+Sign)"
                                data-image-alt-1="POCUS: large pleural effusion with atelectatic lung - 'jellyfish sign'"
                                data-image-placeholder-2="https://placehold.co/400x300/e0f2fe/0c4a6e?text=Pleural+Effusion+(Spine+Sign)"
                                data-image-alt-2="POCUS: 'spine sign' indicative of pleural effusion"
                                data-diagnosis-title="Diagnosis: Large Malignant Pleural Effusion"
                                data-diagnosis-explanation="Interpretation & Outcome: POCUS rapidly confirms a large pleural effusion as the cause of the patient's symptoms and physical exam findings. Given the history, this is highly likely to be a malignant effusion. POCUS accurately assesses the size and location, identifies key landmarks (diaphragm, lung), and allows selection of a safe site for drainage, avoiding injury to underlying structures. A POCUS-guided thoracentesis was performed, removing 1.5L of fluid, resulting in significant improvement in dyspnea. Fluid analysis confirmed malignant cells.">
                            See Details & Findings
                        </button>
                    </article>

                    <article class="case bg-white rounded-xl border border-gray-200 shadow-sm hover:shadow-lg transition-shadow duration-300 p-6 md:p-8 overflow-hidden">
                        <h3 class="text-xl font-semibold text-blue-800 mb-4">Case Study: Unilateral Leg Swelling Post-Surgery</h3>
                         <p class="text-gray-700 mb-4">A 68-year-old male presented with acute swelling and pain in his left leg 1 week after hip replacement.</p>
                         <dl class="text-sm space-y-2 mb-5">
                             <div>
                                <dt class="font-semibold text-gray-800 inline">Clinical Presentation:</dt>
                                <dd class="inline text-gray-600 ml-1">Left calf swelling (3cm > right), erythema, tenderness along the deep venous system. Recent major orthopedic surgery.</dd>
                            </div>
                            <div>
                                <dt class="font-semibold text-gray-800 inline">POCUS Application:</dt>
                                <dd class="inline text-gray-600 ml-1">Lower Extremity Venous Compression Ultrasound.</dd>
                            </div>
                             <div>
                                <dt class="font-semibold text-gray-800 inline">Key Question:</dt>
                                <dd class="inline text-gray-600 ml-1">What specific POCUS maneuver is used to rule out proximal DVT at the bedside?</dd>
                            </div>
                        </dl>
                         <button class="read-more-btn bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-full shadow hover:shadow-md transition duration-300 ease-in-out focus-visible:outline-white"
                                data-title="Case Study: Unilateral Leg Swelling Post-Surgery"
                                data-vignette="A 68-year-old male, 1 week post-total hip arthroplasty, presents with 2 days of progressive left leg swelling, calf pain, and redness. Exam reveals pitting edema and calf circumference 3 cm greater than the asymptomatic right leg. Tenderness is noted on deep palpation of the calf. Wells score is calculated as intermediate risk for DVT."
                                data-imaging="A 2-point compression ultrasound is performed using a high-frequency linear probe. At the common femoral vein (CFV) in the groin crease, the vein (V) fails to fully collapse with adequate probe pressure, while the adjacent femoral artery (A) remains patent (Image 1). In the popliteal fossa behind the knee, the popliteal vein (PV) also demonstrates incomplete compressibility with echogenic material noted within the lumen (Image 2)."
                                data-image-placeholder-1="https://placehold.co/400x300/e0f2fe/0c4a6e?text=DVT+CFV+(Non-compressible)"
                                data-image-alt-1="POCUS DVT Scan: Non-compressible common femoral vein"
                                data-image-placeholder-2="https://placehold.co/400x300/e0f2fe/0c4a6e?text=DVT+Popliteal+(Non-compressible)"
                                data-image-alt-2="POCUS DVT Scan: Non-compressible popliteal vein"
                                data-diagnosis-title="Diagnosis: Deep Vein Thrombosis (DVT)"
                                data-diagnosis-explanation="Interpretation & Outcome: Failure of the common femoral vein and/or popliteal vein to fully compress with adequate probe pressure is the primary diagnostic criterion for DVT using the simplified 2- or 3-point compression technique. Non-compressibility indicates the presence of thrombus within the vein. This positive POCUS finding allows for rapid initiation of anticoagulation therapy, reducing the risk of pulmonary embolism. The patient was started on therapeutic anticoagulation.">
                            See Details & Findings
                        </button>
                    </article>

                    <article class="case bg-white rounded-xl border border-gray-200 shadow-sm hover:shadow-lg transition-shadow duration-300 p-6 md:p-8 overflow-hidden">
                        <h3 class="text-xl font-semibold text-blue-800 mb-4">Case Study: Right Upper Quadrant Pain and Fever</h3>
                        <p class="text-gray-700 mb-4">A 42-year-old female presented with severe RUQ pain, nausea, and fever after eating a fatty meal.</p>
                        <dl class="text-sm space-y-2 mb-5">
                            <div>
                                <dt class="font-semibold text-gray-800 inline">Clinical Presentation:</dt>
                                <dd class="inline text-gray-600 ml-1">Severe, constant RUQ pain radiating to the right shoulder, nausea, vomiting, fever (38.5°C), positive Murphy's sign on exam.</dd>
                            </div>
                            <div>
                                <dt class="font-semibold text-gray-800 inline">POCUS Application:</dt>
                                <dd class="inline text-gray-600 ml-1">RUQ / Hepatobiliary Ultrasound.</dd>
                            </div>
                             <div>
                                <dt class="font-semibold text-gray-800 inline">Key Question:</dt>
                                <dd class="inline text-gray-600 ml-1">What are the key sonographic signs used to diagnose acute cholecystitis with POCUS?</dd>
                            </div>
                        </dl>
                        <button class="read-more-btn bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-full shadow hover:shadow-md transition duration-300 ease-in-out focus-visible:outline-white"
                                data-title="Case Study: Right Upper Quadrant Pain and Fever"
                                data-vignette="A 42-year-old female presents with 12 hours of constant, severe RUQ abdominal pain, accompanied by nausea, two episodes of vomiting, and subjective fever. The pain started shortly after eating fried chicken. Exam reveals marked tenderness in the RUQ with inspiratory arrest during palpation (positive Murphy's sign). Temp 38.5°C, HR 105."
                                data-imaging="Bedside RUQ POCUS performed with a curvilinear probe identifies multiple hyperechoic foci within the gallbladder lumen casting distinct posterior acoustic shadows, consistent with gallstones (cholelithiasis). The anterior gallbladder wall measures 5 mm (thickened, normal < 3-4 mm). A thin rim of anechoic fluid is noted surrounding the gallbladder (pericholecystic fluid). Maximal tenderness is elicited when the probe is directly over the gallbladder (sonographic Murphy's sign)."
                                data-image-placeholder-1="https://raw.githubusercontent.com/Health-Codex/QR-Code/main/Cholecysitis%20image%201.jpg"
                                data-image-alt-1="POCUS Gallbladder: Multiple gallstones with posterior acoustic shadowing"
                                data-image-placeholder-2="https://placehold.co/400x300/e0f2fe/0c4a6e?text=Cholecystitis+(Wall+Thickening,+Fluid)"
                                data-image-alt-2="POCUS Gallbladder: Thickened wall and pericholecystic fluid in acute cholecystitis"
                                data-diagnosis-title="Diagnosis: Acute Cholecystitis"
                                data-diagnosis-explanation="Interpretation & Outcome: The combination of gallstones plus secondary signs of inflammation (gallbladder wall thickening >3-4 mm, pericholecystic fluid, sonographic Murphy's sign) on POCUS are highly suggestive of acute cholecystitis. These findings, correlating with the clinical presentation, expedite diagnosis and management. The patient was admitted, started on IV antibiotics, and underwent laparoscopic cholecystectomy within 24 hours.">
                            See Details & Findings
                        </button>
                    </article>

                    <article class="case bg-white rounded-xl border border-gray-200 shadow-sm hover:shadow-lg transition-shadow duration-300 p-6 md:p-8 overflow-hidden">
                        <h3 class="text-xl font-semibold text-blue-800 mb-4">Case Study: Elderly Male with Back Pain & Syncope</h3>
                        <p class="text-gray-700 mb-4">A 75-year-old male with known hypertension presented with sudden onset severe back pain and syncope.</p>
                        <dl class="text-sm space-y-2 mb-5">
                            <div>
                                <dt class="font-semibold text-gray-800 inline">Clinical Presentation:</dt>
                                <dd class="inline text-gray-600 ml-1">Sudden severe tearing back/abdominal pain, syncope, hypotension (BP 80/50), tachycardia (HR 110), pale and diaphoretic.</dd>
                            </div>
                            <div>
                                <dt class="font-semibold text-gray-800 inline">POCUS Application:</dt>
                                <dd class="inline text-gray-600 ml-1">Abdominal Aorta Ultrasound.</dd>
                            </div>
                             <div>
                                <dt class="font-semibold text-gray-800 inline">Key Question:</dt>
                                <dd class="inline text-gray-600 ml-1">How can POCUS be used to rapidly assess for a catastrophic vascular emergency in this hypotensive patient with back pain?</dd>
                            </div>
                        </dl>
                        <button class="read-more-btn bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-full shadow hover:shadow-md transition duration-300 ease-in-out focus-visible:outline-white"
                                data-title="Case Study: Back Pain & Syncope"
                                data-vignette="A 75-year-old male with a history of HTN and smoking presents via EMS after syncope. Prior to losing consciousness, he experienced sudden, severe 'tearing' back pain radiating to his abdomen. Vitals: BP 80/50, HR 110, RR 20. Patient is pale, cool, and diaphoretic. Abdomen is soft but diffusely tender; no clear pulsatile mass felt."
                                data-imaging="Emergency bedside POCUS of the abdominal aorta is performed using a low-frequency curvilinear probe. Transverse views obtained from the epigastrium down to the bifurcation reveal a significantly dilated aorta, measuring 6.5 cm maximal outer wall to outer wall diameter (normal < 3 cm). Mural thrombus (MT) is noted lining the aneurysmal sac. Longitudinal views confirm the fusiform aneurysm."
                                data-image-placeholder-1="https://placehold.co/400x300/e0f2fe/0c4a6e?text=AAA+Transverse+View+(Measurement)"
                                data-image-alt-1="POCUS AAA Transverse view: Measurement of dilated aorta"
                                data-image-placeholder-2="https://placehold.co/400x300/e0f2fe/0c4a6e?text=AAA+Longitudinal+View+(Thrombus)"
                                data-image-alt-2="POCUS AAA Longitudinal view: Dilated aorta with mural thrombus"
                                data-diagnosis-title="Diagnosis: Abdominal Aortic Aneurysm (AAA) - High Suspicion for Rupture"
                                data-diagnosis-explanation="Interpretation & Outcome: Identification of a large AAA (aortic diameter > 3 cm, especially > 5.5 cm) via POCUS in a patient presenting with symptoms concerning for rupture (acute pain, hypotension, syncope) is a critical, time-sensitive finding. While POCUS may not directly visualize retroperitoneal hematoma (rupture), detecting the AAA itself in this clinical context is sufficient to presume rupture until proven otherwise. Immediate vascular surgery consultation was obtained, massive transfusion protocol was initiated, and the patient was taken directly to the OR for emergent open AAA repair.">
                            See Details & Findings
                        </button>
                    </article>

                </div> </section>

            <section class="anatomy text-center mb-12" aria-labelledby="anatomy-heading">
                <h2 id="anatomy-heading" class="text-3xl md:text-4xl font-semibold text-blue-700 mb-8">Interactive POCUS Anatomy</h2>
                <figure class="max-w-md mx-auto relative" id="anatomy-figure">
                    <!-- Enhanced 3D-like container with depth effect -->
                    <div class="anatomy-container relative overflow-hidden rounded-xl shadow-2xl border-2 border-blue-100">
                        <!-- Enhanced 3D human body model using SVG with gradients and shadows -->
                        <!-- Using realistic anatomical image from Wikimedia Commons -->
                        <img src="anatomy_skeleton_organs.svg" id="anatomy-diagram-img" class="w-full h-auto block bg-white" alt="Human anatomy diagram with organs and skeleton" />

                        <!-- Overlay effect for 3D appearance -->
                        <div class="absolute inset-0 pointer-events-none shadow-inner"
                             style="box-shadow: inset 0 0 30px rgba(0,0,0,0.2), inset 0 0 10px rgba(255,255,255,0.5);">
                        </div>

                        <!-- Interactive anatomy regions with enhanced styling -->
                        <div id="anatomy-region-vascular-neck" class="anatomy-overlay" tabindex="0" role="button"
                             aria-label="Interactive Region: Neck Vascular (IJV)"
                             data-info="<strong>Neck Vascular:</strong> Assess internal jugular vein (IJV) patency, size, and relationship to carotid artery for central venous catheter placement guidance. <br><br><em>Key POCUS Applications:</em> Central line placement, volume status assessment, identification of venous thrombosis."
                             data-region="neck"></div>

                        <div id="anatomy-region-lungs" class="anatomy-overlay" tabindex="0" role="button"
                             aria-label="Interactive Region: Lung Areas (Chest)"
                             data-info="<strong>Lungs:</strong> Evaluate for pneumothorax (sliding, lung point), B-lines (pulmonary edema, interstitial syndromes), consolidation (pneumonia), pleural effusion. <br><br><em>Key POCUS Applications:</em> BLUE protocol, eFAST exam, lung sliding assessment, A-lines and B-lines identification, pleural effusion quantification."
                             data-region="lungs"></div>

                        <div id="anatomy-region-cardiac" class="anatomy-overlay" tabindex="0" role="button"
                             aria-label="Interactive Region: Cardiac Area (Heart)"
                             data-info="<strong>Cardiac:</strong> Assess global function (LV/RV squeeze), pericardial effusion/tamponade, severe RV strain (PE), gross valvular dysfunction, volume status (IVC). <br><br><em>Key POCUS Applications:</em> FOCUS exam, RUSH protocol, pericardial effusion assessment, ejection fraction estimation, IVC collapsibility."
                             data-region="heart"></div>

                        <div id="anatomy-region-ruq" class="anatomy-overlay" tabindex="0" role="button"
                             aria-label="Interactive Region: Right Upper Quadrant (RUQ - Liver, Gallbladder)"
                             data-info="<strong>RUQ:</strong> Assess gallbladder (stones, wall thickening, CBD dilation, sonographic Murphy's), liver parenchyma, Morison's pouch (FAST free fluid), right kidney (hydronephrosis), right pleural space (effusion). <br><br><em>Key POCUS Applications:</em> FAST exam, biliary pathology assessment, hydronephrosis evaluation, hepatic vein assessment."
                             data-region="ruq"></div>

                        <div id="anatomy-region-luq" class="anatomy-overlay" tabindex="0" role="button"
                             aria-label="Interactive Region: Left Upper Quadrant (LUQ - Spleen, Stomach)"
                             data-info="<strong>LUQ:</strong> Assess spleen (size, texture), splenorenal recess (FAST free fluid), left kidney (hydronephrosis), left pleural space (effusion). <br><br><em>Key POCUS Applications:</em> FAST exam, splenic size assessment, renal pathology evaluation, perisplenic fluid detection."
                             data-region="luq"></div>

                        <div id="anatomy-region-pelvis" class="anatomy-overlay" tabindex="0" role="button"
                             aria-label="Interactive Region: Pelvic Area (Bladder)"
                             data-info="<strong>Pelvis:</strong> Assess for free fluid (FAST - suprapubic view, pouch of Douglas), bladder volume/catheter placement. <br><br><em>Key POCUS Applications:</em> FAST exam, bladder volume assessment, urinary retention evaluation, early pregnancy assessment, ectopic pregnancy screening."
                             data-region="pelvis"></div>

                        <div id="anatomy-region-vascular-leg" class="anatomy-overlay" tabindex="0" role="button"
                             aria-label="Interactive Region: Leg Vascular (Femoral)"
                             data-info="<strong>Leg Vascular:</strong> Assess common femoral vein (CFV) and popliteal vein (PV) compressibility for proximal Deep Vein Thrombosis (DVT) screening. <br><br><em>Key POCUS Applications:</em> 2-point or 3-point compression technique for DVT, vascular access guidance, arterial flow assessment."
                             data-region="leg"></div>
                    </div>

                    <!-- Enhanced information display with HTML formatting support -->
                    <figcaption id="anatomy-info" class="mt-5 text-base text-gray-700 min-h-[8em] leading-relaxed bg-gradient-to-br from-blue-50 to-white p-5 rounded-lg border border-blue-200 shadow-inner">
                        <div class="flex items-center justify-center mb-2 text-blue-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span class="font-medium">Interactive POCUS Anatomy Guide</span>
                        </div>
                        <p id="anatomy-info-text">Explore POCUS applications by clicking on the highlighted anatomical regions. Each region shows key ultrasound applications and clinical relevance.</p>
                    </figcaption>
                </figure>
            </section>

        </main>
    </div>

    <div id="modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 p-4 opacity-0" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-description" aria-hidden="true">
        <div id="modal-content-box" class="bg-white rounded-lg shadow-xl p-6 md:p-8 max-w-3xl w-full relative transform opacity-100 scale-100 overflow-y-auto max-h-[90vh]">
            <button id="modal-close-icon" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 transition-colors z-10 p-1 rounded-full focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2" aria-label="Close modal">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>

            <h3 id="modal-title" class="text-2xl md:text-3xl font-semibold text-blue-700 mb-6 text-center pr-8"></h3>

            <div id="modal-description">
                <div class="mb-5 text-left border-b border-gray-200 pb-5">
                    <h4 class="text-xl font-semibold text-gray-800 mb-3">Clinical Vignette:</h4>
                    <p id="modal-vignette" class="text-gray-700 leading-relaxed"></p>
                </div>

                <div class="mb-6 text-left">
                    <h4 class="text-xl font-semibold text-gray-800 mb-3">POCUS Findings:</h4>
                    <div id="modal-imaging-content" class="space-y-4">
                        <p id="modal-imaging-text" class="text-gray-700 leading-relaxed"></p>
                        <div id="modal-image-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                            </div>
                    </div>
                </div>
            </div> <div id="reveal-button-container" class="text-center mb-6 pt-4 border-t border-gray-200">
                 <button id="modal-reveal-button" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-8 rounded-full shadow hover:shadow-md transition duration-300 ease-in-out text-lg focus-visible:outline-white">
                     Reveal Diagnosis & Interpretation
                 </button>
            </div>

            <div id="diagnosis-section" class="diagnosis-section hidden bg-blue-50 p-5 rounded-lg border border-blue-200 text-left mt-4">
                <h4 id="modal-diagnosis-title" class="text-xl font-semibold text-blue-800 mb-3"></h4>
                <p id="modal-diagnosis-explanation" class="text-blue-900 leading-relaxed"></p>
            </div>

            <div class="text-center mt-8">
                <button id="modal-close-button" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-6 rounded-full shadow hover:shadow-md transition duration-300 ease-in-out focus-visible:outline-white">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Element Selection ---
            const modal = document.getElementById('modal');
            const modalContentBox = document.getElementById('modal-content-box');
            const modalTitle = document.getElementById('modal-title');
            const modalVignette = document.getElementById('modal-vignette');
            const modalImagingText = document.getElementById('modal-imaging-text');
            const modalImageContainer = document.getElementById('modal-image-container');
            const revealButtonContainer = document.getElementById('reveal-button-container');
            const modalRevealButton = document.getElementById('modal-reveal-button');
            const diagnosisSection = document.getElementById('diagnosis-section');
            const modalDiagnosisTitle = document.getElementById('modal-diagnosis-title');
            const modalDiagnosisExplanation = document.getElementById('modal-diagnosis-explanation');
            const closeModalIcon = document.getElementById('modal-close-icon');
            const closeModalButton = document.getElementById('modal-close-button');
            const mainContent = document.querySelector('main'); // For event delegation

            const anatomyFigure = document.getElementById('anatomy-figure');
            const anatomyInfo = document.getElementById('anatomy-info');
            const anatomyOverlays = document.querySelectorAll('.anatomy-overlay');
            const anatomyInfoTextElement = document.getElementById('anatomy-info-text');
            const defaultAnatomyText = anatomyInfoTextElement ? anatomyInfoTextElement.innerHTML : "Explore POCUS applications by clicking on the highlighted anatomical regions. Each region shows key ultrasound applications and clinical relevance.";

            // --- State Variables ---
            let previouslyFocusedElement = null; // To return focus on modal close
            let currentCaseData = {}; // Store data for the currently open modal

            // --- Modal Functions ---

            /**
             * Adds an image element to the modal image container. Includes error handling.
             * @param {string} src - Image source URL.
             * @param {string} alt - Image alt text.
             */
              function addImageToModal(src, alt) {
                  // Add console log before setting src
                  console.log(`Attempting to load image: ${src}`);
                  const img = document.createElement('img');
                  // Validate src before assigning
                  if (typeof src !== 'string' || src.trim() === '') {
                      console.error(`Invalid image src provided: ${src}. Displaying fallback.`);
                      img.src = `https://placehold.co/400x300/fecaca/991b1b?text=Invalid+Image+Source`; // Placeholder for invalid source
                      img.alt = 'Error: Invalid image source provided - ' + (alt || 'No description available.');
                  } else {
                      img.src = src;
                      img.alt = alt || 'Image description not provided.'; // Provide default alt text
                  }
                  img.loading = 'lazy'; // Defer loading off-screen images
                  img.className = 'w-full h-auto rounded shadow object-contain mx-auto border border-gray-200 bg-gray-50'; // Style the image

                  // Error handling for broken image links or network issues
                  img.onerror = () => {
                      // Add console log inside onerror
                      console.error(`ERROR loading image: ${img.src}. Displaying fallback.`);
                      // Fallback for external load failures
                      img.src = `https://placehold.co/400x300/fecaca/991b1b?text=Image+Load+Error`; // Display error placeholder
                      img.alt = 'Error: Failed to load image - ' + (alt || 'No description available.'); // Update alt text
                  };
                  modalImageContainer.appendChild(img); // Add the image to the container
              }


            /**
             * Opens the modal and populates it with case study data.
             * @param {object} data - The case study data object from button attributes.
             */
            function openModal(data) {
                // Ensure essential elements exist
                if (!modal || !modalTitle || !modalVignette || !modalImagingText || !modalImageContainer || !diagnosisSection || !modalRevealButton || !revealButtonContainer || !modalContentBox) {
                    console.error("Modal elements missing from the DOM.");
                    return;
                }

                 // Validation check using direct property access (since data is now built with getAttribute)
                 if (!data.title || !data.vignette || !data.imaging || !data.diagnosisTitle || !data.diagnosisExplanation || !data.imagePlaceholder1 || !data.imageAlt1) {
                     console.error("Incomplete case data passed to openModal:", data);
                     return;
                 }


                // Store data and reference to the button that opened the modal
                currentCaseData = data;
                previouslyFocusedElement = document.activeElement;

                // Populate Modal Content
                modalTitle.textContent = data.title;
                modalVignette.textContent = data.vignette;
                modalImagingText.textContent = data.imaging;

                // Clear previous images and add new ones using direct data properties
                modalImageContainer.innerHTML = '';
                addImageToModal(data.imagePlaceholder1, data.imageAlt1);
                if (data.imagePlaceholder2 && data.imageAlt2) {
                    addImageToModal(data.imagePlaceholder2, data.imageAlt2);
                }

                 // Adjust grid layout based on number of images successfully added
                 const imageCount = modalImageContainer.children.length;
                 modalImageContainer.className = `grid gap-4 mt-4 ${imageCount > 1 ? 'grid-cols-1 sm:grid-cols-2' : 'grid-cols-1'}`;


                // Reset state: Hide diagnosis, show reveal button
                diagnosisSection.classList.add('hidden');
                modalDiagnosisTitle.textContent = ''; // Clear previous diagnosis text
                modalDiagnosisExplanation.textContent = '';
                revealButtonContainer.classList.remove('hidden');

                // Show Modal with transitions
                modal.setAttribute('aria-hidden', 'false');
                modal.classList.remove('opacity-0');
                // Ensure content box is visible before scrolling
                requestAnimationFrame(() => {
                    modalContentBox.scrollTop = 0; // Scroll to top
                    modalContentBox.classList.remove('opacity-0', 'scale-95'); // Ensure visible if previously hidden
                });


                 // Set focus to the close icon button after a short delay to allow rendering
                  setTimeout(() => closeModalIcon.focus(), 50);


                // Add event listeners for modal interaction
                addModalEventListeners();
            }


            /**
             * Reveals the diagnosis section in the modal.
             */
            function revealDiagnosis() {
                 // Ensure elements and data exist
                if (!diagnosisSection || !modalDiagnosisTitle || !modalDiagnosisExplanation || !revealButtonContainer || !currentCaseData.diagnosisTitle) {
                    console.error("Cannot reveal diagnosis - missing elements or data.");
                    return;
                }

                // Populate and show diagnosis
                modalDiagnosisTitle.textContent = currentCaseData.diagnosisTitle;
                modalDiagnosisExplanation.textContent = currentCaseData.diagnosisExplanation;
                diagnosisSection.classList.remove('hidden');

                // Hide the reveal button
                revealButtonContainer.classList.add('hidden');

                // Smoothly scroll the diagnosis into view if needed
                diagnosisSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }

            /**
             * Closes the modal and cleans up listeners and state.
             */
            function closeModal() {
                if (!modal) return;

                // Hide modal with transition
                modal.classList.add('opacity-0');
                modal.setAttribute('aria-hidden', 'true');
                 // Reset transform/opacity on content box for next open
                 modalContentBox.classList.add('opacity-0', 'scale-95');


                // Clean up state
                currentCaseData = {};

                // Remove event listeners to prevent memory leaks
                removeModalEventListeners();

                // Return focus to the element that opened the modal
                if (previouslyFocusedElement) {
                    // Check if the element still exists and is focusable
                    if (document.body.contains(previouslyFocusedElement) && typeof previouslyFocusedElement.focus === 'function') {
                         previouslyFocusedElement.focus();
                    }
                    previouslyFocusedElement = null; // Clear reference
                }
            }

            /**
             * Adds necessary event listeners for modal interactions.
             */
            function addModalEventListeners() {
                modal.addEventListener('keydown', handleModalKeydown);
                modal.addEventListener('click', handleModalBackgroundClick);
                closeModalIcon.addEventListener('click', closeModal);
                closeModalButton.addEventListener('click', closeModal);
                modalRevealButton.addEventListener('click', revealDiagnosis);
            }

             /**
             * Removes event listeners added for the modal.
             */
            function removeModalEventListeners() {
                modal.removeEventListener('keydown', handleModalKeydown);
                modal.removeEventListener('click', handleModalBackgroundClick);
                closeModalIcon.removeEventListener('click', closeModal);
                closeModalButton.removeEventListener('click', closeModal);
                modalRevealButton.removeEventListener('click', revealDiagnosis);
            }

            /**
             * Handles keydown events within the modal (Escape, Tab).
             * @param {KeyboardEvent} event
             */
            function handleModalKeydown(event) {
                if (event.key === 'Escape') {
                    closeModal();
                } else if (event.key === 'Tab') {
                    trapFocus(modalContentBox, event); // Pass the modal content box
                }
            }

            /**
             * Closes the modal if the user clicks on the semi-transparent background.
             * @param {MouseEvent} event
             */
            function handleModalBackgroundClick(event) {
                // Check if the click target is the modal background itself
                if (event.target === modal) {
                    closeModal();
                }
            }

            /**
             * Traps focus within a given container element.
             * @param {HTMLElement} containerElement - The element containing focusable items.
             * @param {KeyboardEvent} event - The Tab keydown event.
             */
            function trapFocus(containerElement, event) {
                const focusableElements = Array.from(
                    containerElement.querySelectorAll(
                        'button, [href], input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])'
                    )
                ).filter(el => !el.closest('.hidden') && el.offsetParent !== null && getComputedStyle(el).visibility !== 'hidden' && !el.disabled);

                if (focusableElements.length === 0) {
                    event.preventDefault(); // Prevent tabbing out if nothing is focusable
                    return;
                }

                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];
                const currentActive = document.activeElement;

                if (event.shiftKey) { // Tab + Shift
                    if (currentActive === firstElement || !containerElement.contains(currentActive)) {
                        lastElement.focus();
                        event.preventDefault();
                    }
                } else { // Tab
                    if (currentActive === lastElement || !containerElement.contains(currentActive)) {
                        firstElement.focus();
                        event.preventDefault();
                    }
                }
            }


            // --- Event Delegation for Case Study Buttons ---
            if (mainContent) {
                mainContent.addEventListener('click', (event) => {
                    const button = event.target.closest('.read-more-btn');
                    if (button) { // Check if a button was clicked
                         // *** Use getAttribute to read data attributes directly ***
                         const caseData = {
                             title: button.getAttribute('data-title'),
                             vignette: button.getAttribute('data-vignette'),
                             imaging: button.getAttribute('data-imaging'),
                             diagnosisTitle: button.getAttribute('data-diagnosis-title'),
                             diagnosisExplanation: button.getAttribute('data-diagnosis-explanation'),
                             imagePlaceholder1: button.getAttribute('data-image-placeholder-1'), // Use getAttribute
                             imageAlt1: button.getAttribute('data-image-alt-1'),             // Use getAttribute
                             imagePlaceholder2: button.getAttribute('data-image-placeholder-2'), // Use getAttribute
                             imageAlt2: button.getAttribute('data-image-alt-2')              // Use getAttribute
                         };

                         // *** Update validation check to use the retrieved attributes ***
                         if (caseData.title && caseData.vignette && caseData.imaging && caseData.diagnosisTitle && caseData.diagnosisExplanation && caseData.imagePlaceholder1 && caseData.imageAlt1) {
                             openModal(caseData);
                         } else {
                              // Log the button itself and the collected data for debugging
                              console.error("Button clicked, but missing essential data attributes. Button:", button, "Collected Data:", caseData);
                         }
                    }
                });
            } else {
                console.error("Main content area not found for event delegation.");
            }


            // --- Enhanced Interactive Anatomy Diagram Logic ---

            // Get the anatomy info text element for more precise targeting
            const anatomyInfoText = document.getElementById('anatomy-info-text');
            const anatomyContainer = document.querySelector('.anatomy-container');
            const anatomyDiagramImg = document.getElementById('anatomy-diagram-img');

            // Track the currently active region
            let activeRegion = null;

            /**
             * Updates the anatomy information caption with enhanced HTML content.
             * @param {string} infoHTML - The HTML content to display. If empty, shows default text.
             * @param {HTMLElement} activeOverlay - The currently active overlay element.
             */
            function showAnatomyInfo(infoHTML, activeOverlay = null) {
                if (!anatomyInfoText) return;

                // Remove active class from all overlays first
                anatomyOverlays.forEach(overlay => {
                    overlay.classList.remove('active');
                });

                // If we have an active overlay, add the active class to it
                if (activeOverlay) {
                    activeOverlay.classList.add('active');

                    // Apply subtle 3D tilt effect to the image based on region position
                    if (anatomyDiagramImg && anatomyContainer) {
                        const region = activeOverlay.dataset.region || '';
                        applyTiltEffect(region);
                    }
                } else {
                    // Reset the image transform when no region is active
                    if (anatomyDiagramImg) {
                        anatomyDiagramImg.style.transform = 'translateZ(0)';
                    }
                }

                // Update the info text with HTML content
                if (infoHTML) {
                    anatomyInfoText.innerHTML = infoHTML;
                } else {
                    anatomyInfoText.innerHTML = defaultAnatomyText;
                }
            }

            /**
             * Applies a subtle 3D tilt effect to the anatomy image based on the active region.
             * @param {string} region - The active region identifier.
             */
            function applyTiltEffect(region) {
                if (!anatomyDiagramImg) return;

                // Default transform
                let transform = 'translateZ(0)';

                // Apply different transforms based on region
                switch(region) {
                    case 'neck':
                        transform = 'perspective(1000px) rotateX(5deg) translateZ(10px)';
                        break;
                    case 'lungs':
                        transform = 'perspective(1000px) rotateY(0deg) translateZ(15px)';
                        break;
                    case 'heart':
                        transform = 'perspective(1000px) rotateY(-3deg) translateZ(20px)';
                        break;
                    case 'ruq':
                        transform = 'perspective(1000px) rotateY(-5deg) rotateX(-2deg) translateZ(15px)';
                        break;
                    case 'luq':
                        transform = 'perspective(1000px) rotateY(5deg) rotateX(-2deg) translateZ(15px)';
                        break;
                    case 'pelvis':
                        transform = 'perspective(1000px) rotateX(-5deg) translateZ(10px)';
                        break;
                    case 'leg':
                        transform = 'perspective(1000px) rotateX(-8deg) translateZ(5px)';
                        break;
                    default:
                        transform = 'translateZ(0)';
                }

                // Apply the transform with a smooth transition
                anatomyDiagramImg.style.transform = transform;
            }

            /**
             * Handles click or keyboard activation of an anatomy region.
             * @param {HTMLElement} overlay - The overlay element being activated.
             */
            function activateRegion(overlay) {
                if (!overlay) return;

                // Get the info HTML from the data attribute
                const infoHTML = overlay.dataset.info;

                // If this is already the active region, deactivate it
                if (activeRegion === overlay) {
                    activeRegion = null;
                    showAnatomyInfo(null);
                } else {
                    // Otherwise, activate the new region
                    activeRegion = overlay;
                    showAnatomyInfo(infoHTML, overlay);

                    // Ensure the overlay is visible (scroll into view if needed)
                    overlay.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }

            // Setup enhanced listeners for anatomy overlays if they exist
            if (anatomyFigure && anatomyOverlays.length > 0 && anatomyInfoText) {
                // Add a subtle hover effect to the entire container
                if (anatomyContainer) {
                    anatomyContainer.addEventListener('mousemove', (event) => {
                        // Only apply hover effect if no region is currently active
                        if (!activeRegion) {
                            const rect = anatomyContainer.getBoundingClientRect();
                            const x = event.clientX - rect.left; // x position within the element
                            const y = event.clientY - rect.top;  // y position within the element

                            // Calculate the tilt based on mouse position
                            const centerX = rect.width / 2;
                            const centerY = rect.height / 2;
                            const tiltX = (y - centerY) / 20; // Divide by a larger number for subtler effect
                            const tiltY = (centerX - x) / 20;

                            // Apply the tilt effect
                            if (anatomyDiagramImg) {
                                anatomyDiagramImg.style.transform = `perspective(1000px) rotateX(${tiltX}deg) rotateY(${tiltY}deg) translateZ(5px)`;
                            }
                        }
                    });

                    // Reset transform when mouse leaves the container
                    anatomyContainer.addEventListener('mouseleave', () => {
                        // Only reset if no region is active
                        if (!activeRegion && anatomyDiagramImg) {
                            anatomyDiagramImg.style.transform = 'translateZ(0)';
                        }
                    });
                }

                // Enhanced overlay interaction
                anatomyOverlays.forEach(overlay => {
                    // Click activation
                    overlay.addEventListener('click', (event) => {
                        event.preventDefault();
                        activateRegion(overlay);
                    });

                    // Keyboard activation
                    overlay.addEventListener('keydown', (event) => {
                        if (event.key === 'Enter' || event.key === ' ') {
                            event.preventDefault();
                            activateRegion(overlay);
                        }
                    });

                    // Focus handling
                    overlay.addEventListener('focus', () => {
                        // Show info without activating fully
                        if (activeRegion !== overlay) {
                            showAnatomyInfo(overlay.dataset.info, overlay);
                        }
                    });

                    overlay.addEventListener('blur', () => {
                        // Use setTimeout to allow focus to shift before checking
                        setTimeout(() => {
                            // Only reset if focus moved outside overlays and there's no active region
                            const activeElementIsOverlay = document.activeElement &&
                                                          document.activeElement.classList.contains('anatomy-overlay');
                            if (!activeElementIsOverlay && !activeRegion) {
                                showAnatomyInfo(null);
                            }
                        }, 0);
                    });

                    // Mouse hover effects
                    overlay.addEventListener('mouseenter', () => {
                        // Only show info if this isn't already the active region
                        if (activeRegion !== overlay) {
                            showAnatomyInfo(overlay.dataset.info, overlay);
                        }
                    });

                    overlay.addEventListener('mouseleave', () => {
                        // Only reset if this isn't the active region
                        if (activeRegion !== overlay) {
                            showAnatomyInfo(null);
                        }
                    });
                });

                // Add a click listener to the figure background to deactivate regions
                anatomyFigure.addEventListener('click', (event) => {
                    // Only deactivate if clicking directly on the background (not an overlay or the info box)
                    if (!event.target.classList.contains('anatomy-overlay') &&
                        !anatomyInfo.contains(event.target) &&
                        activeRegion) {
                        activeRegion = null;
                        showAnatomyInfo(null);
                    }
                });

            } else if (anatomyInfoText) {
                anatomyInfoText.innerHTML = "<strong>Error:</strong> Interactive anatomy diagram components not fully loaded.";
                console.warn("Anatomy overlays or figure container not found.");
            }

        }); // End DOMContentLoaded
    </script>

</body>
</html>
